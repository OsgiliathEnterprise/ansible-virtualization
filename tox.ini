[tox]
requires =
    tox>4
    virtualenv>20.2
labels =
    testenv = py311
env_list =
    dependency
    lint
    create
    converge
    converge-monorepo
    test-exec
    ci
    verify
    idempotence
    destroy
[testenv:dependency]
deps =
    -r requirements.txt
commands = molecule dependency
[testenv:lint]
deps =
    -r requirements.txt
commands =
    yamllint .
    flake8
    ansible-lint
[testenv:create]
setenv =
    DEPENDENCY_ENABLED=False
deps =
    -r requirements.txt
commands = molecule create
[common-converge]
setenv =
    ANSIBLE_ROLES_PATH={toxinidir}/../community:{toxinidir}/../oss:{toxinidir}/..
    ANSIBLE_COLLECTIONS_PATH={toxinidir}/../community-collections
[testenv:converge]
setenv =
    {[common-converge]setenv}
deps =
    -r requirements.txt
commands = molecule converge
[testenv:converge-monorepo]
setenv =
    {[common-converge]setenv}
    REQUIREMENTS_PATH={toxinidir}/requirements-monorepo.yml
deps =
    -r requirements.txt
commands = molecule converge
[testenv:test-exec]
setenv =
    {[common-converge]setenv}
deps =
    -r requirements.txt
commands = molecule test
[testenv:ci]
setenv =
    {[common-converge]setenv}
deps =
    -r requirements.txt
commands = molecule test --scenario-name kvm
[testenv:verify]
setenv =
    {[common-converge]setenv}
deps =
    -r requirements.txt
commands = molecule verify
[testenv:idempotence]
setenv =
    {[common-converge]setenv}
deps =
    -r requirements.txt
commands = molecule idempotence
[testenv:destroy]
setenv =
    DEPENDENCY_ENABLED=False
deps =
    -r requirements.txt
commands =
    molecule destroy
